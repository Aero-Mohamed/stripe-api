# Stripe API

## Summery
### Stripe Integration and PCI DSS Compliance

- **Review of Stripe Security and PCI DSS Compliance**
    - Investigated how Stripe handles card information and learned that storing sensitive credit card data (e.g., card number, CVV, expiration date) on servers is prohibited.
    - Ensured that the application complies with Payment Card Industry Data Security Standard (PCI DSS) requirements to manage client cards securely.

### Project Setup and Configuration

- **API Setup**
    - Set up the Laravel project to function as an API application.
    - By mistake I have installed Laravel Sanctum for basic API authentication.
    - Then, Added Passport package to handle JWT requirements (using `lcobucci/jwt`).

- **Basic API Configuration**
    - **Force JSON Middleware**: Configured middleware to always accept JSON responses.
    - **Response Shape**: Implemented a fixed response shape using `ApiResponse` trait.
    - **Exception Handling**: Created an exception handler to return responses consistent with the `ApiResponse` trait's standards.

### Development and Testing

- **Authentication**
    - Implemented login and registration functionalities.
    - Wrote unit tests for authentication features.

- **Stripe Service**
    - Developed a Stripe service for handling payments.

- **Controllers**
    - Completed controllers responsible for storing and charging users.

- **Testing**
    - Attempted Mock Testing with Stripe PHP SDK, but found it complex to fake.
    - Opted for sandbox testing, configuring `.env.testing` with Stripe sandbox data.

### Code Quality and Static Analysis

- **Code Standards**
    - Configured PHP Code Sniffer to enforce PSR-12 coding standards.

- **Static Code Analysis**
    - Set up PHPStan for static code analysis to ensure code quality and identify potential issues.


## Installation

### Extension Requirements
- `ext-sodium`

### Installation Guide
- `composer install`
- `php artisan key:generate`
- `chmod -R 777 storage bootstrap/cache`
- `php artisan migrate:fresh --seed --force`

### Passport JWT Installation
- **Generate Encryption Keys**
  - `php artisan passport:keys --force`
- **Generate Client**
  - `php artisan passport:client --password --name=Client1 --provider=users`
  - you will need the output client id & client secret in the login request.

### API Docs
- Api documentation is generated by Scribe and available at `/docs`

## Code Quality 
### Unit Test
- **Testing**
    - `php artisan test`
- **Testing** with coverage report
  - Code coverage driver is needed (Xdebug or PCOV)
  - `php artisan test --coverage`

### Code Quality
- **Static Code Analysis** (PHP Stan + LaraStan) - Testing for potential errors.
    - `./vendor/bin/phpstan analyse`
- **Php Code Sniffer** - Testing for Common Standard for code writing style.
    - Detect Problems `./vendor/bin/phpcs --standard=PSR12 app`
    - Fix Problems `./vendor/bin/phpcbf --standard=PSR12 app`

